<%= simple_form_for @experiment_user do |f| %>
  <% if @experiment_user.errors.any? %>
    <div class="mt-4" id="error_explanation">
      <h6>The form is incomplete and can therefore not be saved. <br>
        Please fill in the field(s) marked in red below:</h6>
    </div>
  <% end %>

  <%= f.hidden_field :experiment_id, value: @experiment.id %>

  <% if activating_experiment %>
    <div>
      <span>For the upcoming 3 weeks, you'll be trying out the experiment
        <strong><span class="text-brand"><%= @experiment.name %></span></strong>.
      </span>
      <h5 class="mt-4 text-intense">Objective</h5>
      <p>
        <i class="fas fa-trophy"></i>
        <span><%= @experiment.objective %></span>
      </p>
    </div>
    <div class="row">
      <div class="col-12">
        <h5 class="mt-2 text-intense">Starting date</h5>
        <span>When would you like to start the experiment?</span>
        <%= f.input :starting_date,
        as: :select,
        collection: [["Today", DateTime.current], ["Tomorrow", (DateTime.current + 1).beginning_of_day]],
        selected: "Today",
        label: false,
        input_html: { class: "col-md-3 mt-2" } %>
      </div>
      <div class="col-12">
        <h5 class="mt-2 text-intense">Your starting measurement</h5>
        <div class="mb-4">
          <span>
            Recall your last 3 weeks. How did you feel?<br>
            Rate the statements below from 1 (<span class="text-error">completely disagree</span>) to 5 (<span class="text-success">completely agree</span>).
          </span>
        </div>
        <%= f.simple_fields_for :experiment_user_measurements do |experiment_user_measurement| %>
          <%= experiment_user_measurement.hidden_field :id %>
          <%= experiment_user_measurement.hidden_field :benefit_id %>
          <%= experiment_user_measurement.object.benefit.measurement_statement %>
          <abbr title="required">*</abbr>
          <%= experiment_user_measurement.input :starting_score, required: true, label: false, collection: 1..5, as: :radio_buttons, wrapper: :horizontal_collection_inline %>
        <% end %>
      </div>
    </div>

  <% elsif cancelling_experiment %>
    <div>
      <span>You're cancelling the experiment. You can retry it later if you want to, starting from day 1 again.</span>
    </div>
    <div class="row">
      <div class="col-md-5">
        <span>Why are you cancelling the experiment?</span>
        <%= f.input :cancellation_reason,
        as: :select,
        collection: ExperimentUser::CANCELLATION_REASONS.invert,
        label: false
        %>
      </div>
    </div>

  <% elsif completing_experiment %>
    <div class="mb-4">
      <span>YAY! You completed the experiment "<strong><%= @experiment.name %>".</strong></span>
    </div>
    <div class="row">
      <div class="col-md-9">
        <h4 class="text-intense">Your ending measurement</h4>
        <div class="mb-4">
          Recall your last 3 weeks. How did you feel?<br>
          Rate the statements below from 1 (<span class="text-error">completely disagree</span>) to 5 (<span class="text-success">completely agree</span>).
        </div>
        <div>
          <%= f.simple_fields_for :experiment_user_measurements do |experiment_user_measurement| %>
            <%= experiment_user_measurement.hidden_field :id %>
            <%= experiment_user_measurement.hidden_field :benefit_id %>
            <%= experiment_user_measurement.object.benefit.measurement_statement %>
            <abbr title="required">*</abbr>
            <%= experiment_user_measurement.input :ending_score, required: true, label: false, collection: 1..5, as: :radio_buttons, wrapper: :horizontal_collection_inline %>
          <% end %>
        </div>
      </div>
      <div class="col-md-6 col-lg-4">
        <span>Was it easy for you to stick to the experiment?</span>
        <abbr title="required">*</abbr>
        <%= f.input :difficulty,
        as: :select,
        collection: ExperimentUser::DIFFICULTY_RATES.invert,
        label: false %>

        <span>How big of an impact has this experiment had on your life?</span>
        <abbr title="required">*</abbr>
        <%= f.input :life_impact,
        as: :select,
        collection: ExperimentUser::LIFE_IMPACT_OPTIONS.invert,
        label: false %>

        <span>Any other observations? Unexpected benefits you may have experienced?</span>
        <%= f.input :ending_note,
        as: :text,
        label: false,
        input_html: { rows: 6 } %>
      </div>
    </div>
  <% end %>

  <div>
    <%= f.submit "#{start_or_cancel_experiment} this experiment", class: "btn btn-primary" %>
  </div>
<% end %>
